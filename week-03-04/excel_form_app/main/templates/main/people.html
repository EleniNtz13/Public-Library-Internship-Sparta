<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <title>Προβολή όλων των εγγραφών</title>  <!-- Page title -->

    <style>
        /* ===== TABLE STYLING ===== */
        table {
            border-collapse: collapse; /* Merge borders */
            width: 100%; /* Full width table */
        }

        th, td {
            border: 1px solid #000; /* Black border */
            padding: 6px; /* Cell padding */
            font-size: 12px; /* Small font */
            text-align: left; /* Align text to left */
            vertical-align: top; /* Align top */
            word-break: normal; /* Do not break words */
            hyphens: none; /* Disable hyphenation */
        }

        th {
            background-color: #eee; /* Light gray background for header */
        }

        /* ====== PRINT ONLY ====== */
        @media print {

            .no-print {
                display: none !important; /* Hide elements with class "no-print" */
            }

            body {
                margin: 0; /* Remove body margin for print */
            }

            @page {
                size: A3 landscape; /* Set page size */
                margin: 10mm; /* Page margin */
            }

            /* Clear preview - hide scrollbars */
            html, body {
                overflow: hidden !important; 
            }

            /* Fix table layout for print */
            table {
                table-layout: fixed; /* Fixed column widths */
                width: 100%;
                font-size: 11px; /* Slightly smaller font */
            }

            tbody td {
                font-size: 10.5px; /* Smaller font for tbody cells */
            }

            /* Slightly wider columns for title & publisher */
            col.title-col {
                width: 13%;
            }

            col.publisher-col {
                width: 12%;
            }

            col.supply-col {
                width: 9%;
            }

            /* Prevent ugly word breaks */
            td {
                white-space: normal;
                overflow-wrap: normal;
            }

            /* Keep table header visible on page break */
            thead {
                display: table-header-group;
            }

            /* Avoid breaking rows inside pages */
            tr {
                page-break-inside: avoid;
            }
        }
    </style>
</head>

<body>

<!-- Top buttons container -->
<div class="no-print" style="margin-bottom:15px; display:flex; gap:10px;">
    <a href="{% url 'home' %}"
       style="padding:6px 14px; background:#2c7be5; color:white; text-decoration:none; border-radius:4px; font-weight:bold;">
        Αρχική <!-- Home button text -->
    </a>
</div>

{% if not request.GET %}  <!-- Check if no GET parameters -->
<h1>Προβολή όλων των εγγραφών</h1>  <!-- Page heading -->
{% endif %}

{% if not request.GET %}  <!-- Check if no GET parameters -->
<form class="no-print"
      method="get"
      style="margin-bottom:15px; display:flex; gap:12px; align-items:center; font-size:14px;">
      
    <!-- From input -->
    <label>
        Από
        <input type="number" name="from_num" required style="width:90px;">
    </label>

    <!-- To input -->
    <label>
        Έως
        <input type="number" name="to_num" required style="width:90px;">
    </label>

    <button type="submit">Εκτύπωση</button> <!-- Print button -->
</form>
{% endif %}

<!-- Table container -->
<div>
<table id="booksTable">

    <!-- Column groups for width control -->
    <colgroup>
        <col>
        <col>
        <col>
        <col>
        <col class="title-col"> <!-- Title column -->
        <col class="publisher-col"> <!-- Publisher column -->
        <col>
        <col>
        <col>
        <col>
        <col>
        <col>
        <col class="supply-col"> <!-- Supply column -->
        <col>
        <col>
        <col>
    </colgroup>

    <!-- Table header -->
    <thead>
        <tr>
            <th>Αριθμός Εισαγωγής</th> <!-- Entry number -->
            <th>Ημερομηνία Εισαγωγής</th> <!-- Entry date -->
            <th>Συγγραφέας</th> <!-- Author -->
            <th>ΚΟΗΑ</th> <!-- KOHA field -->
            <th>Τίτλος</th> <!-- Title -->
            <th>Εκδότης</th> <!-- Publisher -->
            <th>Έκδοση</th> <!-- Edition -->
            <th>Έτος Έκδοσης</th> <!-- Year of publication -->
            <th>Τόπος Έκδοσης</th> <!-- Place of publication -->
            <th>Σχήμα</th> <!-- Format/Shape -->
            <th>Σελίδες</th> <!-- Pages -->
            <th>Τόμος</th> <!-- Volume -->
            <th>Τρόπος Προμηθείας/Παραλαβής</th> <!-- Supply/Receiving -->
            <th>ISBN</th> <!-- ISBN -->
            <th>Στήλη1</th> <!-- Custom column 1 -->
            <th>Στήλη2</th> <!-- Custom column 2 -->
        </tr>
    </thead>

    <!-- Table body -->
    <tbody>
        {% for p in people %}  <!-- Loop through all people records -->
        <tr>
            <td>{{ p.ari8mosEisagoghs }}</td>
            <td>{{ p.hmeromhnia_eis }}</td>
            <td>{{ p.syggrafeas }}</td>
            <td>{{ p.koha }}</td>
            <td>{{ p.titlos }}</td>
            <td>{{ p.ekdoths }}</td>
            <td>{{ p.ekdosh }}</td>
            <td>{{ p.etosEkdoshs }}</td>
            <td>{{ p.toposEkdoshs }}</td>
            <td>{{ p.sxhma }}</td>
            <td>{{ p.selides }}</td>
            <td>{{ p.tomos }}</td>
            <td>{{ p.troposPromPar }}</td>
            <td>{{ p.ISBN }}</td>
            <td>{{ p.sthlh1 }}</td>
            <td>{{ p.sthlh2 }}</td>
        </tr>
        {% endfor %}
    </tbody>

</table>
</div>

<script>
window.onload = function () {  // Run after page loads

    const table = document.getElementById("booksTable"); // Table element
    const rows = Array.from(table.tBodies[0].rows); // Get all table rows

    const params = new URLSearchParams(window.location.search); // Get URL parameters
    if (params.has('from_num') && params.has('to_num')) { // Check if filtering by range
        const from = Number(params.get('from_num')); // Convert from_num to number
        const to = Number(params.get('to_num')); // Convert to_num to number

        rows.forEach(row => {
            const value = Number(row.cells[0].innerText); // First cell = entry number
            if (value < from || value > to) {
                row.style.display = "none"; // Hide rows outside range
            }
        });

        window.print(); // Open print dialog
    }
};
</script>

</body>
</html>
