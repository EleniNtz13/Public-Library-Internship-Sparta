{% load static %}  {# Load Django static files template tag #}
<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">  {# Set character encoding to UTF-8 #}
    <title>Νέα Εισαγωγή</title>  {# Page title shown to the user, in Greek #}

<style>

/* Container under the input for title autocomplete */
#title-suggestions {
    border: 1px solid #ccc;  /* Light gray border */
    max-height: 200px;        /* Maximum height of suggestions box */
    overflow: auto;           /* Scroll if content exceeds max-height */
    width: 100%;              /* Full width relative to parent */
    background-color: white;  /* White background */
    position: absolute;       /* Float over the form */
    z-index: 1000;            /* Ensure it appears on top */
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);  /* Slight shadow for depth */
    padding: 0;               /* No inner padding */
    margin: 0;                /* No margin */
}

/* Individual suggestion items */
.suggestion-item {
    padding: 8px 12px;        /* Inner spacing */
    cursor: pointer;          /* Pointer cursor on hover */
    border-bottom: 1px solid #eee;  /* Light bottom border */
}

/* Highlight suggestion item on hover */
.suggestion-item:hover {
    background-color: #f0f0f0;
}

/* Container under the input for publisher autocomplete */
#ekdoths-suggestions {
    border: 1px solid #ccc;
    max-height: 200px;
    overflow: auto;
    width: 100%;
    background-color: white;
    position: absolute;       /* Float over the form */
    z-index: 1000;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    padding: 0;
    margin: 0;
}

/* Individual suggestion items for publisher */
.suggestion-item {
    padding: 8px 12px;
    cursor: pointer;
    border-bottom: 1px solid #eee;
}

.suggestion-item:hover {
    background-color: #f0f0f0;
}

/* Apply border-box sizing to all elements */
* {
    box-sizing: border-box;
}

/* Page background and font */
body {
    background: #f4f7fb;
    font-family: "Segoe UI", sans-serif;
    margin: 0;
    padding: 0;
}

/* Main content wrapper */
.page-wrapper {
    max-width: 1400px;        /* Limit maximum width */
    margin: 30px auto;        /* Center horizontally with top/bottom margin */
    padding: 25px;            /* Inner spacing */
    background: white;        /* White background */
    border-radius: 10px;      /* Rounded corners */
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);  /* Light shadow */
}

/* Main heading */
h1 {
    margin-bottom: 25px;      /* Space below heading */
    color: #1f3c88;           /* Dark blue text */
}

/* Form layout using CSS grid */
form {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));  /* Responsive columns */
    gap: 16px;                /* Space between form fields */
    width: 100%;              /* Full width */
}

/* Individual form field container */
.field-box {
    position: relative;       /* Needed for autocomplete dropdowns */
    background: #e8f0ff;      /* Light blue background */
    padding: 10px;
    border-radius: 8px;
    border-left: 4px solid #1f3c88;  /* Blue left border */
}

/* Labels inside field-box */
.field-box label {
    display: block;
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 5px;
    color: #1f3c88;           /* Blue label color */
}

/* Inputs, textareas, and selects styling */
input,
textarea,
select {
    width: 100%;
    padding: 6px 8px;
    border-radius: 5px;
    border: 1px solid #c6d4ff;
    font-size: 14px;
    background: #fff;
}

/* Read-only inputs */
input[readonly] {
    background: #dde6ff;      /* Slightly darker blue */
    font-weight: bold;         /* Bold text */
}

/* Textarea adjustments for automatic height */
textarea {
    resize: none;              /* Prevent manual resizing */
    overflow: auto;
    min-height: 28px;
    line-height: 1.3;
}

/* Container for submit buttons */
.submit-wrapper {
    grid-column: 1 / -1;       /* Span entire grid */
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    margin-top: 25px;
    flex-wrap: wrap;           /* Wrap buttons on small screens */
}

/* Primary button styling */
button {
    background: #1f3c88;
    color: white;
    border: none;
    padding: 11px 30px;
    font-size: 15px;
    font-weight: 600;
    border-radius: 6px;
    cursor: pointer;
}

/* Hover effect for primary buttons */
button:hover {
    background: #162c63;
}

/* Secondary button styling (links styled as buttons) */
.btn-secondary {
    background: #2d6cdf;
    color: white;
    text-decoration: none;
    padding: 11px 30px;
    border-radius: 6px;
    font-size: 15px;
    font-weight: 600;
}

/* Hover effect for secondary buttons */
.btn-secondary:hover {
    background: #1f56b3;
}

/* Submission message styling */
.submit-msg {
    font-size: 14px;
    color: #1f3c88;
    font-weight: 600;
}
</style>
</head>

<body>
<div class="page-wrapper">
    <h1>Νέα Εισαγωγή Βιβλίου</h1>  {# Heading for the form in Greek #}

    <form method="post">  {# Start form, POST method #}
        {% csrf_token %}  {# Django CSRF protection #}

        {# Entry number, read-only #}
        <div class="field-box">
            <label>ΑΡΙΘΜΟΣ ΕΙΣΑΓΩΓΗΣ</label>
            <input type="text" value="{{ next_number }}" readonly>
        </div>

        {# Date field #}
        <div class="field-box">
            <label>ΗΜΕΡΟΜΗΝΙΑ ΕΙΣΑΓΩΓΗΣ</label>
            {{ form.hmeromhnia_eis }}
        </div>

        {# Author field #}
        <div class="field-box">
            <label>ΣΥΓΓΡΑΦΕΑΣ</label>
            {{ form.syggrafeas }}
        </div>

        {# KOHA author field, auto-filled #}
        <div class="field-box">
            <label>ΣΥΓΓΡΑΦΕΑΣ KOHA</label>
            {{ form.koha }}
        </div>

        {# Title field with autocomplete #}
        <div class="field-box">
            <label>ΤΙΤΛΟΣ</label>
            {{ form.titlos }}
            <div id="title-suggestions" class="autocomplete-box"></div>
        </div>

        {# Publisher field with autocomplete #}
        <div class="field-box">
            <label>ΕΚΔΟΤΗΣ</label>
            {{ form.ekdoths }}
            <div id="ekdoths-suggestions" class="autocomplete-box"></div>
        </div>

        {# Edition field #}
        <div class="field-box">
            <label>ΕΚΔΟΣΗ</label>
            {{ form.ekdosh }}
        </div>

        {# Year field #}
        <div class="field-box">
            <label>ΕΤΟΣ ΕΚΔΟΣΗΣ</label>
            {{ form.etosEkdoshs }}
        </div>

        {# Place of publication #}
        <div class="field-box">
            <label>ΤΟΠΟΣ ΕΚΔΟΣΗΣ</label>
            {{ form.toposEkdoshs }}
        </div>

        {# Form other fields (Shape, Pages, Volume, Notes, ISBN, Column1, Column2) #}
        <div class="field-box">
            <label>ΣΧΗΜΑ</label>
            {{ form.sxhma }}
        </div>
        <div class="field-box">
            <label>ΣΕΛΙΔΕΣ</label>
            {{ form.selides }}
        </div>
        <div class="field-box">
            <label>ΤΟΜΟΣ</label>
            {{ form.tomos }}
        </div>
        <div class="field-box">
            <label>ΤΡΟΠΟΣ ΠΡΟΜΗΘΕΙΑΣ / ΠΑΡΑΤΗΡΗΣΕΙΣ</label>
            {{ form.troposPromPar }}
        </div>
        <div class="field-box">
            <label>ISBN</label>
            {{ form.ISBN }}
        </div>
        <div class="field-box">
            <label>ΣΤΗΛΗ 1</label>
            {{ form.sthlh1 }}
        </div>
        <div class="field-box">
            <label>ΣΤΗΛΗ 2</label>
            {{ form.sthlh2 }}
        </div>

        {# Submit buttons #}
        <div class="submit-wrapper">
            <a href="{% url 'home' %}" class="btn-secondary">Αρχική</a>  {# Link to home page #}
            <button type="submit" onclick="return confirmSubmit();">Υποβολή</button>  {# Submit button #}

            {# Show submission message if query parameter exists #}
            {% if request.GET.submitted == "1" %}
            <span class="submit-msg" id="submit-msg">Υποβλήθηκε</span>
            {% endif %}
        </div>
    </form>
</div>

{# JavaScript confirmation for submit #}
<script>
function confirmSubmit() {
    return confirm("Είσαι σίγουρος για αυτήν την υποβολή?");  // User confirmation in Greek
}
</script>

{# jQuery for autocomplete #}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'main/autocomplete.js' %}"></script>

{# Auto-expand textareas and hide submission message after 3s #}
<script>
document.addEventListener("DOMContentLoaded", function () {

    document.querySelectorAll("textarea").forEach(el => {
        el.addEventListener("input", function () {
            this.style.height = "auto";  // Reset height
            this.style.height = this.scrollHeight + "px";  // Expand to fit content
        });
    });

    const msg = document.getElementById("submit-msg");
    if (msg) {
        setTimeout(() => {
            msg.style.display = "none";  // Hide the message

            // Clear URL query parameters
            window.history.replaceState(
                {},
                document.title,
                window.location.pathname
            );

        }, 3000);  // After 3 seconds
    }
});
</script>

{# Autofill KOHA field based on author input (surname,name -> name surname) #}
<script>
document.addEventListener("DOMContentLoaded", function () {
    const authorInput = document.getElementById("id_syggrafeas");
    const kohaInput = document.getElementById("id_koha");

    if (!authorInput || !kohaInput) return;  // Exit if elements not found

    authorInput.addEventListener("blur", function () {
        let value = this.value.trim();

        // Expected format: surname,name
        if (!value.includes(",")) return;

        let parts = value.split(",");

        if (parts.length !== 2) return;

        let surname = parts[0].trim();
        let name = parts[1].trim();

        if (!surname || !name) return;

        // Autofill KOHA as "name surname"
        kohaInput.value = `${name} ${surname}`;
    });
});
</script>

</body>
</html>
